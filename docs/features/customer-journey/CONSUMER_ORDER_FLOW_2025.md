# Consumer Order Flow 2025 - Detailed Visual Documentation

> **Last Updated**: 2025-10-26
> **Purpose**: Complete ASCII visual diagram of the current CircleTel B2C consumer order flow
> **Status**: Active Implementation (2025)
> **Format**: Text-based ASCII diagrams for maximum compatibility

---

## Quick Reference

**Journey Duration**: 4-6 minutes (average)
**Total Steps**: 5 pages (Homepage â†’ Packages â†’ Account â†’ Service Address â†’ Payment â†’ Confirmation)
**Progress Indicator**: 3-step TopProgressBar (Account â†’ Service Address â†’ Payment)
**State Management**: OrderContext (localStorage + server sync)

---

## Table of Contents

1. [High-Level Flow Overview](#1-high-level-flow-overview)
2. [Detailed Complete Flow (ASCII)](#2-detailed-complete-flow-ascii)
3. [Authentication Flow Details](#3-authentication-flow-details)
4. [Page Reference Table](#4-page-reference-table)
5. [State Management & Persistence](#5-state-management--persistence)
6. [Progress Bar Mapping](#6-progress-bar-mapping)

---

## 1. High-Level Flow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Homepage   â”‚â”€â”€â”€â”€â–¶â”‚   Packages   â”‚â”€â”€â”€â”€â–¶â”‚   Account   â”‚â”€â”€â”€â”€â–¶â”‚ Service Addressâ”‚â”€â”€â”€â”€â–¶â”‚ Payment  â”‚â”€â”€â”€â”€â–¶â”‚ Confirmation â”‚
â”‚      /      â”‚     â”‚/packages/[id]â”‚     â”‚/order/accountâ”‚    â”‚/order/service- â”‚     â”‚/order/   â”‚     â”‚/order/       â”‚
â”‚             â”‚     â”‚              â”‚     â”‚              â”‚     â”‚   address      â”‚     â”‚ payment  â”‚     â”‚confirmation  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Enter Address      Select Package      Create Account      Installation Info     Pay & Submit      Order Complete
                                         (OAuth or Email)
```

**Key Decision Points:**
- **Packages**: Service type (Fibre/LTE/5G)
- **Account**: Google OAuth OR Email/Password signup
- **Account**: Email verification (if needed)
- **Payment**: 20+ payment methods via NetCash

---

## 2. Detailed Complete Flow (ASCII)

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚         CIRCLETEL HOMEPAGE              â”‚
                                    â”‚            app/page.tsx                 â”‚
                                    â”‚                                         â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                    â”‚  â”‚     HeroWithTabs Component      â”‚   â”‚
                                    â”‚  â”‚   â€¢ Residential/Business Tabs   â”‚   â”‚
                                    â”‚  â”‚   â€¢ Address Autocomplete        â”‚   â”‚
                                    â”‚  â”‚   â€¢ Interactive Map Link        â”‚   â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚  User enters address â”‚
                                       â”‚  (Google Places API) â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  POST /api/coverage/lead          â”‚
                                    â”‚  â€¢ Create coverage lead in DB     â”‚
                                    â”‚  â€¢ Store address + coordinates    â”‚
                                    â”‚  â€¢ Store coverage type (res/biz)  â”‚
                                    â”‚  â€¢ Generate leadId                â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚   Redirect to /packages/[leadId]   â”‚
                                  â”‚       ?type=residential|business   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  PACKAGES PAGE                                                      â”‚
â”‚                          app/packages/[leadId]/page.tsx                                             â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Fetch packages: GET /api/coverage/packages?leadId=[id]&type=[res/biz]                 â”‚    â”‚
â”‚  â”‚ 2. Display ServiceToggle: [ Fibre ] [ LTE ] [ 5G ]                                        â”‚    â”‚
â”‚  â”‚ 3. Show package grid with CompactPackageCard components                                   â”‚    â”‚
â”‚  â”‚ 4. Pagination: Show 8 packages initially, "Load More" button                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                     â”‚
â”‚  Desktop:                                     Mobile:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Package Grid   â”‚  Detail Sidebar â”‚       â”‚     Package Grid              â”‚                    â”‚
â”‚  â”‚  (8 cards)      â”‚  (Sticky)       â”‚       â”‚     (Stacked)                 â”‚                    â”‚
â”‚  â”‚                 â”‚                 â”‚       â”‚                               â”‚                    â”‚
â”‚  â”‚  [Click card]   â”‚  â€¢ Package info â”‚       â”‚  [Click card]                 â”‚                    â”‚
â”‚  â”‚      â”‚          â”‚  â€¢ Features     â”‚       â”‚       â”‚                       â”‚                    â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â€¢ Pricing      â”‚       â”‚       â–¼                       â”‚                    â”‚
â”‚  â”‚                 â”‚  â€¢ [Order Now]  â”‚       â”‚  Bottom Sheet Modal           â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â€¢ Package details            â”‚                    â”‚
â”‚                           â”‚                   â”‚  â€¢ [Order Now]                â”‚                    â”‚
â”‚                           â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Click "Order Now" button     â”‚
                        â”‚  â€¢ Save package to OrderContextâ”‚
                        â”‚  â€¢ Redirect to /order/account  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               ACCOUNT CREATION PAGE                                                 â”‚
â”‚                           app/order/account/page.tsx                                                â”‚
â”‚                           Progress Bar: Step 1 of 3 â¬¤â”€â”€â—‹â”€â”€â—‹                                        â”‚
â”‚                           OrderContext Stage: 2                                                     â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Form Fields (React Hook Form + Zod validation):                                          â”‚    â”‚
â”‚  â”‚  â€¢ Email (required, validated)                                                             â”‚    â”‚
â”‚  â”‚  â€¢ Password (min 8 chars, required)                                                        â”‚    â”‚
â”‚  â”‚  â€¢ Phone (required, SA format)                                                             â”‚    â”‚
â”‚  â”‚  â€¢ Terms & Conditions checkbox (required)                                                  â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  Autosave: Email + Phone debounced to OrderContext (1s delay)                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                       AUTHENTICATION METHOD CHOICE                              â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚              â”‚
â”‚  â”‚  â”‚  Email/Password      â”‚              â”‚   Google OAuth           â”‚            â”‚              â”‚
â”‚  â”‚  â”‚  Signup              â”‚              â”‚   Sign In                â”‚            â”‚              â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚              â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚            â”‚              â”‚
â”‚  â”‚  â”‚  [Create Account]    â”‚      OR      â”‚   [Continue with Google] â”‚            â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚              â”‚
â”‚  â”‚             â”‚                                       â”‚                            â”‚              â”‚
â”‚  â”‚             â–¼                                       â–¼                            â”‚              â”‚
â”‚  â”‚  signUp(email, password)              signInWithGoogle()                        â”‚              â”‚
â”‚  â”‚             â”‚                                       â”‚                            â”‚              â”‚
â”‚  â”‚             â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  OAuth Redirect              â”‚            â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  â€¢ Google login page         â”‚            â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  â€¢ User grants permission    â”‚            â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  â€¢ Redirect to /auth/callbackâ”‚            â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚    with hash tokens          â”‚            â”‚              â”‚
â”‚  â”‚             â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚              â”‚
â”‚  â”‚             â”‚                                       â”‚                            â”‚              â”‚
â”‚  â”‚             â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  AUTH CALLBACK PAGE                  â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  app/auth/callback/page.tsx          â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  1. Extract tokens from hash         â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  2. setSession(access, refresh)      â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  3. Check if customer exists         â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  4. Create customer record if needed â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â”‚  5. Redirect to ?next param          â”‚    â”‚              â”‚
â”‚  â”‚             â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚
â”‚  â”‚             â”‚                                       â”‚                            â”‚              â”‚
â”‚  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚              â”‚
â”‚  â”‚                                 â”‚                                                â”‚              â”‚
â”‚  â”‚                                 â–¼                                                â”‚              â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚              â”‚
â”‚  â”‚                    â”‚ POST /api/auth/        â”‚                                    â”‚              â”‚
â”‚  â”‚                    â”‚ create-customer        â”‚                                    â”‚              â”‚
â”‚  â”‚                    â”‚ â€¢ Store customer data  â”‚                                    â”‚              â”‚
â”‚  â”‚                    â”‚ â€¢ Link to auth.users   â”‚                                    â”‚              â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚              â”‚
â”‚  â”‚                                 â”‚                                                â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                    â”‚                                                                â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚                     â”‚  Check: Email Verified?     â”‚                                                â”‚
â”‚                     â”‚  user.email_confirmed_at    â”‚                                                â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                            â”‚             â”‚                                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚              â”‚  YES - Verified   â”‚   â”‚  NO - Unverified            â”‚                               â”‚
â”‚              â”‚  (Google OAuth)   â”‚   â”‚  (Email/Password signup)    â”‚                               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                        â”‚                 â”‚                                                          â”‚
â”‚                        â”‚                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                        â”‚                 â””â”€â–¶â”‚  VERIFY EMAIL PAGE                          â”‚        â”‚
â”‚                        â”‚                    â”‚  app/order/verify-email/page.tsx            â”‚        â”‚
â”‚                        â”‚                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ "Check your inbox" message                â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ Resend verification button                â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ 10-minute urgency timer                   â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ FAQ accordion                             â”‚        â”‚
â”‚                        â”‚                    â”‚                                              â”‚        â”‚
â”‚                        â”‚                    â”‚  User clicks link in email                   â”‚        â”‚
â”‚                        â”‚                    â”‚         â”‚                                    â”‚        â”‚
â”‚                        â”‚                    â”‚         â–¼                                    â”‚        â”‚
â”‚                        â”‚                    â”‚  Redirect to /auth/callback                  â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ Verify email token                        â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ Mark email as confirmed                   â”‚        â”‚
â”‚                        â”‚                    â”‚  â€¢ Set session                               â”‚        â”‚
â”‚                        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â”‚                                  â”‚                                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Email Verified & Authenticatedâ”‚
                        â”‚  Redirect to /order/service-   â”‚
                        â”‚  address                       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SERVICE ADDRESS PAGE                                                      â”‚
â”‚                       app/order/service-address/page.tsx                                            â”‚
â”‚                       Progress Bar: Step 2 of 3 â—‹â”€â”€â¬¤â”€â”€â—‹                                            â”‚
â”‚                       OrderContext Stage: 2                                                         â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. Service Type Selection: [ Residential ] [ Business ]                                  â”‚    â”‚
â”‚  â”‚     â€¢ Auto-selected based on OrderContext account type                                     â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  2. Property Type Dropdown (changes based on service type):                               â”‚    â”‚
â”‚  â”‚     Residential Options:                    Business Options:                              â”‚    â”‚
â”‚  â”‚     â€¢ Freestanding Home (SDU)               â€¢ Office or Business Park                     â”‚    â”‚
â”‚  â”‚     â€¢ Gated Estate                          â€¢ Industrial or Warehouse                      â”‚    â”‚
â”‚  â”‚     â€¢ Apartment/Flat Complex                â€¢ Educational Facility                         â”‚    â”‚
â”‚  â”‚     â€¢ Townhouse                             â€¢ Healthcare Facility                          â”‚    â”‚
â”‚  â”‚                                              â€¢ Freestanding Building                        â”‚    â”‚
â”‚  â”‚                                              â€¢ Small Office Home Office (SOHO)             â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  3. Installation Address (Google Places Autocomplete):                                     â”‚    â”‚
â”‚  â”‚     â€¢ Street Address (autocomplete enabled)                                                â”‚    â”‚
â”‚  â”‚     â€¢ Suburb (auto-filled)                                                                 â”‚    â”‚
â”‚  â”‚     â€¢ City (auto-filled)                                                                   â”‚    â”‚
â”‚  â”‚     â€¢ Province (dropdown: 9 SA provinces)                                                  â”‚    â”‚
â”‚  â”‚     â€¢ Postal Code (auto-filled)                                                            â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  Auto-save: All fields debounced to OrderContext                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                      â”‚
â”‚  â”‚  [Back]   [Continue] â”€â”€â–¶â”‚  Validates all required fields                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Save installation address to â”‚
                        â”‚  OrderContext                  â”‚
                        â”‚  Redirect to /order/payment    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                PAYMENT PAGE                                                         â”‚
â”‚                            app/order/payment/page.tsx                                               â”‚
â”‚                            Progress Bar: Step 3 of 3 â—‹â”€â”€â—‹â”€â”€â¬¤                                       â”‚
â”‚                            OrderContext Stage: 3                                                    â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    PAYMENT STAGE COMPONENT                                                 â”‚    â”‚
â”‚  â”‚                 components/order/stages/PaymentStage.tsx                                   â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  Layout (Responsive):                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ LEFT COLUMN (1/3 Desktop, Full Mobile):                                     â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Your Package Card                          â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Package name                             â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Speed (down/up)                          â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Features list                            â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                                                                              â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Installation Address Card                  â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Service address (multi-line)             â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚                                                                              â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Order Summary Card (Sticky)                â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Subtotal                                 â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Installation Fee                         â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Router Fee                               â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ VAT (15%)                                â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Total (prominent)                        â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                              â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Billing Schedule:                           â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Once-off total                           â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â€¢ Monthly recurring                        â”‚                             â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”‚ RIGHT COLUMN (2/3 Desktop, Full Mobile):                                                â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Choose Your Payment Method                                              â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  ğŸ’³ Card Paymentâ”‚  â”‚  âš¡ Instant EFT  â”‚  (2-column grid)               â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  Visa, Master,  â”‚  â”‚  Real-time bank â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  Amex, Diners   â”‚  â”‚  transfer (Ozow)â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  ğŸ¦ Capitec Pay â”‚  â”‚  ğŸ›ï¸ Bank EFT     â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  Fast Capitec   â”‚  â”‚  Online banking â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  payments       â”‚  â”‚  transfer       â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  ğŸ“± Scan to Pay â”‚  â”‚  ğŸ›’ Payflex     â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  QR codes       â”‚  â”‚  Buy now pay    â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  SnapScan/Zapperâ”‚  â”‚  later (4x)     â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  ğŸ« 1Voucher    â”‚  â”‚  ğŸª paymyway    â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  Cash vouchers  â”‚  â”‚  Pay at 24k+    â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  29M customers  â”‚  â”‚  stores         â”‚                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  ğŸ“Š SCode Retailâ”‚  (9 total payment methods)                           â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  Pay at 6k+     â”‚                                                      â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â”‚  outlets        â”‚                                                      â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  [User clicks payment method] â”€â”€â–¶ Shows payment-specific interface        â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚
â”‚  â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  Security Features (3-column icon grid):                                 â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  ğŸ”’ 256-bit SSL    âœ“ PCI DSS Compliant    ğŸ›¡ï¸ Fraud Protection           â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚
â”‚  â”‚  â”‚                                                                                          â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  [ ] I accept the Terms & Conditions and Privacy Policy                  â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚                                                                            â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚  [Back (w-32)]  [ğŸ›¡ï¸ Complete Secure Payment (flex-1, h-12, shadow)] â”€â”€â–¶â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  Payment Processing:                                                                       â”‚    â”‚
â”‚  â”‚  â€¢ POST /api/payments/initiate                                                             â”‚    â”‚
â”‚  â”‚  â€¢ NetCash Pay Now integration                                                             â”‚    â”‚
â”‚  â”‚  â€¢ Redirect to payment gateway OR inline processing                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Payment Processing           â”‚
                        â”‚  â€¢ NetCash gateway            â”‚
                        â”‚  â€¢ Customer completes payment â”‚
                        â”‚  â€¢ Redirect with reference    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CONFIRMATION PAGE                                                        â”‚
â”‚                        app/order/confirmation/page.tsx                                              â”‚
â”‚                                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         âœ“ ORDER CONFIRMED                                                  â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  Thank you for your order! Your payment has been processed successfully.                  â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚  â”‚  Order Details                                                    â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  Payment Reference: [From URL param: ?Reference=...]             â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  Transaction ID: [From URL param: ?TransactionId=...]            â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚                                                                    â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  Package: [Package name from OrderContext]                       â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  Installation Address: [Address from OrderContext]               â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚                                                                    â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  Next Steps:                                                      â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  1. You will receive an order confirmation email                 â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  2. Our team will contact you to schedule installation           â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  3. Installation typically happens within 3-5 business days      â”‚                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                                                                                             â”‚    â”‚
â”‚  â”‚  [View Dashboard]  [Track Order]                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  ORDER COMPLETE! ğŸ‰   â”‚
                                    â”‚  OrderContext cleared  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Authentication Flow Details

### Email/Password Signup Flow

```
/order/account
      â”‚
      â”œâ”€â–¶ User enters email, password, phone
      â”‚
      â”œâ”€â–¶ Click "Create Account"
      â”‚
      â”œâ”€â–¶ signUp(email, password, metadata)
      â”‚       â”‚
      â”‚       â”œâ”€â–¶ Supabase Auth: Create auth.users record
      â”‚       â”‚       â€¢ email_confirmed_at: NULL (unverified)
      â”‚       â”‚       â€¢ Send verification email
      â”‚       â”‚
      â”‚       â””â”€â–¶ POST /api/auth/create-customer
      â”‚               â€¢ Create customers table record
      â”‚               â€¢ Link to auth.users.id
      â”‚               â€¢ Store metadata (phone, etc.)
      â”‚
      â”œâ”€â–¶ Redirect to /order/verify-email
      â”‚
      â””â”€â–¶ VERIFY EMAIL PAGE
              â”‚
              â”œâ”€â–¶ Display instructions
              â”‚   â€¢ "Check your inbox"
              â”‚   â€¢ Resend button (60s cooldown)
              â”‚   â€¢ FAQ section
              â”‚
              â”œâ”€â–¶ User clicks link in email
              â”‚       â”‚
              â”‚       â””â”€â–¶ Redirects to /auth/callback?token=...&type=email
              â”‚
              â””â”€â–¶ AUTH CALLBACK
                      â”‚
                      â”œâ”€â–¶ Verify token
                      â”œâ”€â–¶ Update email_confirmed_at
                      â”œâ”€â–¶ Create session
                      â””â”€â–¶ Redirect to /order/service-address
```

### Google OAuth Flow

```
/order/account
      â”‚
      â”œâ”€â–¶ Click "Continue with Google"
      â”‚
      â”œâ”€â–¶ signInWithGoogle()
      â”‚       â”‚
      â”‚       â”œâ”€â–¶ Redirect to Google login page
      â”‚       â”‚   (hosted by Google)
      â”‚       â”‚
      â”‚       â”œâ”€â–¶ User grants permission
      â”‚       â”‚
      â”‚       â””â”€â–¶ Google redirects back to:
      â”‚           /auth/callback#access_token=...&refresh_token=...
      â”‚
      â””â”€â–¶ AUTH CALLBACK PAGE
              â”‚
              â”œâ”€â–¶ Detect hash fragment (#access_token=...)
              â”‚
              â”œâ”€â–¶ Extract access_token + refresh_token from hash
              â”‚
              â”œâ”€â–¶ supabase.auth.setSession({access_token, refresh_token})
              â”‚
              â”œâ”€â–¶ Check if customer record exists
              â”‚       â”‚
              â”‚       â”œâ”€â–¶ YES: Continue with existing customer
              â”‚       â”‚
              â”‚       â””â”€â–¶ NO: POST /api/auth/create-customer
              â”‚               â€¢ Create customers table record
              â”‚               â€¢ Extract data from Google profile
              â”‚               â€¢ email_confirmed_at: Already set (Google verified)
              â”‚
              â””â”€â–¶ Redirect to ?next param (default: /order/service-address)
```

**Key Differences:**
- **Google OAuth**: Email pre-verified, instant redirect to next step
- **Email/Password**: Requires email verification step, additional page in flow

---

## 4. Page Reference Table

| # | Page | File Path | Purpose | Features | Auth Required | OrderContext Stage |
|---|------|-----------|---------|----------|---------------|-------------------|
| 1 | Homepage | `app/page.tsx` | Coverage check entry point | Address autocomplete, tabs (res/biz), map modal | âŒ No | - |
| 2 | Packages | `app/packages/[leadId]/page.tsx` | Package selection | Service toggle, package grid, pagination, detail sidebar | âŒ No | - |
| 3 | Account | `app/order/account/page.tsx` | Account creation | Email/password signup, Google OAuth, form validation | âŒ No | 2 |
| 4 | Verify Email | `app/order/verify-email/page.tsx` | Email verification instructions | Resend button, FAQ, countdown timer | âš ï¸ Partial | - |
| 5 | Auth Callback | `app/auth/callback/page.tsx` | OAuth & email verification handler | Token exchange, session creation, customer record creation | âš ï¸ Handles | - |
| 6 | Service Address | `app/order/service-address/page.tsx` | Installation address & property type | Google autocomplete, property type selection, address form | âœ… Yes | 2 |
| 7 | Payment | `app/order/payment/page.tsx` | Payment processing | 20+ payment methods, order summary, NetCash integration | âœ… Yes | 3 |
| 8 | Confirmation | `app/order/confirmation/page.tsx` | Order success | Payment reference display, next steps, order details | âœ… Yes | - |
| 9 | Payment Demo | `app/order/payment/demo/page.tsx` | Payment method showcase | Interactive demo (optional) | âŒ No | - |

**Legend:**
- âœ… **Auth Required**: Must be logged in
- âš ï¸ **Partial/Handles**: Handles authentication process
- âŒ **No Auth**: Public access

---

## 5. State Management & Persistence

### OrderContext Structure

**Location**: `components/order/context/OrderContext.tsx`

```typescript
interface OrderState {
  currentStage: number;           // 1-4 (Coverage, Package, Account, Verification)
  orderData: {
    coverage: {
      address?: string;
      coordinates?: { lat: number; lng: number };
      leadId?: string;
      availableServices?: string[];
      locationType?: LocationType;
    };
    package: {
      selectedPackage?: PackageDetails;
      pricing?: PricingDetails;
    };
    account: {
      // Authentication
      email?: string;
      password?: string;
      isAuthenticated?: boolean;

      // Personal Info
      firstName?: string;
      lastName?: string;
      phone?: string;
      idNumber?: string;

      // Account Type
      accountType?: 'personal' | 'business';
      businessName?: string;
      businessRegistration?: string;
      taxNumber?: string;

      // Installation Details
      installationAddress?: Address;
      installationLocationType?: LocationType;
      preferredInstallationDate?: Date;
      alternativeInstallationDate?: Date;
      onsiteContact?: {...};
      specialInstructions?: string;

      // Payment
      paymentMethod?: PaymentMethod;
      termsAccepted?: boolean;
    };
  };
  errors: ValidationErrors;
  isLoading: boolean;
  savedAt?: Date;
  completedSteps: number[];
}
```

### Persistence Strategy

1. **localStorage**: Primary storage (key: `circletel_order_state`)
   - Automatic save on state changes
   - Restored on page refresh
   - Cleared on order completion

2. **Server Sync** (Authenticated users only):
   - API: `/api/order-drafts`
   - Debounced sync (800ms delay)
   - Bidirectional sync:
     - On login: Load server draft if local is empty
     - On state change: Push local to server
   - Deleted on order completion

3. **State Lifecycle**:
   ```
   Homepage â†’ Create order state
        â”‚
   Packages â†’ Add package data
        â”‚
   Account â†’ Add account data
        â”‚
   Service Address â†’ Add installation data
        â”‚
   Payment â†’ Add payment method
        â”‚
   Confirmation â†’ Clear state (order complete)
   ```

---

## 6. Progress Bar Mapping

### TopProgressBar Component

**Location**: `components/order/TopProgressBar.tsx`

**3-Step Visual Progress**:
```
Step 1: Account Creation    â¬¤â”€â”€â—‹â”€â”€â—‹  (currentStep: 1)
Step 2: Service Address     â—‹â”€â”€â¬¤â”€â”€â—‹  (currentStep: 2)
Step 3: Payment            â—‹â”€â”€â—‹â”€â”€â¬¤  (currentStep: 3)
```

**Mapping to Pages**:

| TopProgressBar Step | Page | File | OrderContext Stage |
|---------------------|------|------|-------------------|
| **Step 1** (Account) | `/order/account` | `app/order/account/page.tsx` | 2 |
| **Step 2** (Service Address) | `/order/service-address` | `app/order/service-address/page.tsx` | 2 |
| **Step 3** (Payment) | `/order/payment` | `app/order/payment/page.tsx` | 3 |

**Note**: Progress bar only shows on the 3 checkout pages. Homepage and Packages page have no progress indicator.

**Implementation**:
```tsx
// Account Page
<TopProgressBar currentStep={1} />

// Service Address Page
<TopProgressBar currentStep={2} />

// Payment Page
<TopProgressBar currentStep={3} />
```

---

## 7. API Endpoints Used

| Endpoint | Method | Purpose | Used By |
|----------|--------|---------|---------|
| `/api/coverage/lead` | POST | Create coverage lead | Homepage |
| `/api/coverage/packages` | GET | Fetch available packages | Packages page |
| `/api/auth/create-customer` | POST | Create customer record | Account page, Auth callback |
| `/api/order-drafts` | GET | Load saved order draft | OrderContext (auth users) |
| `/api/order-drafts` | PUT | Save order draft | OrderContext (auth users) |
| `/api/order-drafts` | DELETE | Clear order draft | OrderContext (on completion) |
| `/api/payments/initiate` | POST | Initialize payment | Payment page |

---

## 8. Key Technical Details

### Form Validation Libraries
- **Account Page**: React Hook Form + Zod
- **Service Address**: React state + custom validation

### Google Maps Integration
- **API**: Places Autocomplete API
- **Used on**: Homepage (HeroWithTabs), Service Address page
- **Restriction**: South Africa only (componentRestrictions: {country: 'za'})

### Payment Gateway
- **Provider**: NetCash Pay Now
- **Methods**: 20+ (cards, EFT, QR codes, BNPL, cash vouchers, retail)
- **Integration**: Server-side API + redirect/iframe

### Authentication Provider
- **Service**: Supabase Auth
- **Methods**: Email/Password, Google OAuth
- **Email Verification**: Required for email/password signups
- **Session**: JWT tokens (access + refresh)

### State Libraries
- **Order State**: Zustand (via OrderContext)
- **Form State**: React Hook Form
- **Server State**: React Query (for API calls)

---

## 9. Mobile vs Desktop Differences

### Packages Page

**Desktop (â‰¥1024px)**:
- Side-by-side layout: Package grid (left) + Detail sidebar (right)
- Sidebar is sticky, follows scroll
- Click package â†’ Updates sidebar content
- "Order Now" button always visible in sidebar

**Mobile (<1024px)**:
- Stacked layout: Package grid only
- Click package â†’ Opens bottom sheet modal
- Modal shows package details + "Order Now" button
- Modal slides up from bottom with animation

### Payment Page

**Desktop (â‰¥1024px)**:
- Two-column layout: 1/3 summary (left) + 2/3 payment methods (right)
- Order summary card sticky on scroll
- 2-column payment method grid

**Mobile (<1024px)**:
- Single column: Stacked layout
- Order summary at top (collapsible)
- 1-column payment method list
- Larger touch targets (min 44px)

---

## 10. Error Handling & Edge Cases

### Coverage Not Available
- **Trigger**: No packages found for address
- **Action**: Show NoCoverageLeadCapture component
- **Features**: "Notify me" form, alternative service suggestions

### Authentication Failures
- **Google OAuth fails**: Show error message, offer email/password option
- **Email verification timeout**: Resend button with 60s cooldown
- **Session expired**: Redirect to login with `?next` param to return to flow

### Payment Failures
- **Payment declined**: Show error, allow retry with different method
- **Payment timeout**: Show timeout message, save draft for later
- **Network error**: Auto-retry with exponential backoff

### Data Loss Prevention
- **Browser refresh**: OrderContext restored from localStorage
- **Tab close/reopen**: State persisted, user can continue
- **Session timeout**: Draft saved to server (auth users), can resume on login

---

## 11. Future Enhancements (Roadmap)

- [ ] KYC document upload integration (Step 4 verification)
- [ ] B2B order flow (multi-site, bulk orders)
- [ ] Guest checkout (no account required)
- [ ] Installment payment plans
- [ ] Promo code/voucher system
- [ ] Real-time installation scheduling
- [ ] Order tracking dashboard
- [ ] SMS notifications

---

**Document Version**: 1.0
**Last Updated**: 2025-10-26
**Maintained By**: Development Team
**Related Docs**:
- [Order Types](../../lib/order/types.ts)
- [OrderContext Implementation](../../components/order/context/OrderContext.tsx)
- [Payment Integration](../../components/order/stages/PaymentStage.tsx)
